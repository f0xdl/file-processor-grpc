# üì¶ FileProcessor gRPC
## üéØ –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–°–æ–∑–¥–∞—Ç—å gRPC-—Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π:

* –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤—ã—Ö –ø—É—Ç–µ–π (–∏–ª–∏ –∏–º–µ–Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤).
* –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ–∞–π–ª—ã (–ø–æ–¥—Å—á—ë—Ç —Å—Ç—Ä–æ–∫ –∏ —Å–ª–æ–≤).
* –°—Ç—Ä–∏–º–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞—Ç–Ω–æ –∫–ª–∏–µ–Ω—Ç—É.
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç middleware (interceptor) –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É `context cancellation`.


## üìê –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### gRPC API (protobuf)

```proto
syntax = "proto3";

package fileprocessor;

service FileService {
  rpc ProcessFiles (FileList) returns (stream FileStats);
}

message FileList {
  repeated string paths = 1;
}

message FileStats {
  string path = 1;
  int32 lines = 2;
  int32 words = 3;
  string error = 4; // –µ—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ
}
```



## ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –ö–ª–∏–µ–Ω—Ç

* –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–ø–∏—Å–æ–∫ –ø—É—Ç–µ–π (`paths`) –Ω–∞ —Å–µ—Ä–≤–µ—Ä.
* –ú–æ–∂–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `context.WithTimeout`.

### –°–µ—Ä–≤–µ—Ä

* –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –≥–æ—Ä—É—Ç–∏–Ω–µ (**fan-out**).
* –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –∏ —Å–ª–æ–≤ (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `bufio.Scanner`).
* –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ –º–µ—Ä–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –≤ –≤–∏–¥–µ —Å—Ç—Ä–∏–º–∞.
* –ó–∞–≤–µ—Ä—à–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ `ctx.Done()` (—Ç–∞–π–º–∞—É—Ç –∏–ª–∏ –æ—Ç–º–µ–Ω–∞).



## üîÑ –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

* **Fan-out/fan-in**:

  * fan-out: –≤–æ—Ä–∫–µ—Ä—ã –ø–æ–ª—É—á–∞—é—Ç –∑–∞–¥–∞–Ω–∏—è.
  * fan-in: —Å–æ–±–∏—Ä–∞–µ–º –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–ª–∏–µ–Ω—Ç—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–µ –±–æ–ª–µ–µ **5 —Ñ–∞–π–ª–æ–≤**.

  * –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `semaphore` –∏–ª–∏ –±—É—Ñ–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `channel`.



## üîí Middleware

### Interceptors
* –õ–æ–≥–∏—Ä—É—é—Ç –º–µ—Ç–æ–¥, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –æ—à–∏–±–∫–∏.
* –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç panic.



## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã:

  * –ü–æ–¥—Å—á—ë—Ç —Å—Ç—Ä–æ–∫/—Å–ª–æ–≤.
  * –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞.
  * –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–æ —Ç–∞–π–º–∞—É—Ç—É (`context.Cancel()`).
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç:

  * –ö–ª–∏–µ–Ω—Ç ‚Üî –°–µ—Ä–≤–µ—Ä ‚Üî –†–µ–∑—É–ª—å—Ç–∞—Ç.



## ‚öôÔ∏è –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

* [`google.golang.org/grpc`](https://pkg.go.dev/google.golang.org/grpc)
* [`google.golang.org/protobuf`](https://pkg.go.dev/google.golang.org/protobuf)
* `context`, `os`, `sync`, `bufio`, `time`
* (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) [`golang.org/x/sync/semaphore`](https://pkg.go.dev/golang.org/x/sync/semaphore)



## üöÄ –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

* –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å –ø–æ–º–æ—â—å—é gRPC metadata.
* –•—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏.
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ (–∞ –Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ –∏–º–µ–Ω–∏).
